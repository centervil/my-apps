# Gemini CLI GitHub Actions 統合

このリポジトリには、GitHub Actions ワークフローを通じて Gemini CLI を使用した AI 駆動の自動化機能が含まれています。この統合により、自動コードレビュー、イシュートリアージ、一般的な開発支援が提供されます。

## 🚀 機能

### 自動コードレビュー
- **自動PRレビュー**: すべてのプルリクエストがAI駆動のコードレビューを受けます
- **セキュリティ分析**: 潜在的なセキュリティ脆弱性を特定します
- **パフォーマンス最適化**: パフォーマンス改善を提案します
- **コード品質**: 保守性とベストプラクティスをチェックします
- **重要度レベル**: コメントは優先度別に分類されます（🔴 重要、🟠 高、🟡 中、🟢 低）

### インテリジェントなイシュートリアージ
- **自動分類**: イシューが自動的に分類されます（バグ、機能、ドキュメントなど）
- **優先度評価**: AIが影響度と緊急度に基づいてイシューの優先度を決定します
- **スマートラベリング**: 適切なラベルを自動的に適用します
- **重複検出**: 類似または重複するイシューを特定します
- **アサイン提案**: 専門知識に基づいて潜在的な担当者を推薦します

### 一般的なAI支援
- **コード分析**: 複雑なコードの理解を支援します
- **ドキュメント**: ドキュメントの作成と改善を支援します
- **ベストプラクティス**: 開発のベストプラクティスに関するガイダンスを提供します
- **問題解決**: デバッグとトラブルシューティングを支援します

## 🎯 使用方法

### 自動トリガー

AIアシスタントは以下の場合に自動的に起動します：
- **プルリクエストオープン時**: 自動コードレビューをトリガーします
- **イシューオープン/再オープン時**: 自動トリアージをトリガーします

### 手動トリガー

イシューまたはプルリクエストに以下のようにコメントしてください：

```
@gemini-cli /review [追加コンテキスト]
```
オプションの追加コンテキストと共に、集中的なコードレビューを要求します。

```
@gemini-cli /triage
```
イシューのトリアージと分類を要求します。

```
@gemini-cli [あなたの質問]
```
一般的な支援のために開発関連の質問をします。

### 例

```
@gemini-cli /review セキュリティ脆弱性とパフォーマンスの問題に焦点を当ててください
```

```
@gemini-cli このコードベースで認証を実装するための最適なアプローチを理解するのを手伝ってもらえますか？
```

```
@gemini-cli /triage
```

## 🔧 セットアップ

### 前提条件
1. Gemini API が有効化された Google Cloud プロジェクト
2. Actions が有効化された GitHub リポジトリ
3. 適切な API クォータと課金設定

### クイックセットアップ
1. **シークレットの設定**（リポジトリ設定 → Secrets and variables → Actions）：
   - `GEMINI_API_KEY` または `GOOGLE_API_KEY`
   - `APP_PRIVATE_KEY`（GitHub App を使用する場合）

2. **変数の設定**：
   - `GOOGLE_CLOUD_PROJECT`
   - `GOOGLE_CLOUD_LOCATION`
   - `GEMINI_CLI_VERSION`

3. **ワークフローの有効化**: シークレットが設定されると、ワークフローは自動的に有効になります。

詳細なセットアップ手順については、[docs/gemini-cli-setup.md](docs/gemini-cli-setup.md) を参照してください。

## 🔒 セキュリティ

### アクセス制御
- リポジトリのオーナー、メンバー、コラボレーターのみが手動ワークフローをトリガーできます
- フォーク保護により、フォークからのプルリクエストでの実行を防止します
- すべての API キーとシークレットは GitHub Secrets を通じて安全に管理されます

### プライバシー
- コード分析は安全な GitHub Actions 環境で実行されます
- コードは安全な実行コンテキスト外に保存または送信されません
- すべてのやり取りは監査目的で GitHub Actions にログ記録されます

## 📊 モニタリング

### ワークフローログ
- すべての AI とのやり取りが GitHub Actions にログ記録されます
- トラブルシューティング用のデバッグモードが利用可能です
- パフォーマンスメトリクスが追跡されます

### 使用状況追跡
- API 使用状況は Google Cloud Console を通じて監視されます
- ワークフロー実行時間が追跡されます
- エラー率と成功メトリクスが利用可能です

## 🧪 テスト

### バリデーションテスト
ワークフローバリデーションテストを実行：
```bash
# バリデーションテストをトリガー
gh workflow run test-gemini-workflows.yml
```

### エンドツーエンドテスト
包括的な E2E テストを実行：
```bash
# 基本的な E2E テストを実行
gh workflow run e2e-test-gemini.yml -f test_scenario=basic -f create_test_data=true

# 完全な E2E テストスイートを実行
gh workflow run e2e-test-gemini.yml -f test_scenario=full -f create_test_data=true
```

## 📁 ファイル構造

```
.github/workflows/
├── gemini-dispatch.yml      # メインディスパッチャーワークフロー
├── gemini-review.yml        # コードレビューワークフロー
├── gemini-triage.yml        # イシュートリアージワークフロー
├── gemini-invoke.yml        # 一般支援ワークフロー
├── test-gemini-workflows.yml # バリデーションテスト
└── e2e-test-gemini.yml      # エンドツーエンドテスト

docs/
├── gemini-cli-setup.md      # 詳細セットアップガイド
└── configuration-examples.md # 設定例
```

## 🎛️ 設定

### 環境変数

| 変数 | 説明 | 必須 |
|------|------|------|
| `GEMINI_API_KEY` | Gemini API 認証 | はい* |
| `GOOGLE_API_KEY` | 代替 Google API キー | はい* |
| `GOOGLE_CLOUD_PROJECT` | GCP プロジェクト ID | はい |
| `GOOGLE_CLOUD_LOCATION` | GCP リージョン | はい |
| `GEMINI_CLI_VERSION` | 特定の CLI バージョン | いいえ |
| `DEBUG` | デバッグログを有効化 | いいえ |

*`GEMINI_API_KEY` または `GOOGLE_API_KEY` のいずれかが必要です。

### カスタマイゼーション

ワークフローファイルを編集することで、AI プロンプトと動作をカスタマイズできます：
- レビュー基準と重要度レベル
- トリアージ分類ルール
- レスポンスの形式とトーン
- タイムアウトとパフォーマンス設定

## 🚨 トラブルシューティング

### よくある問題

1. **ワークフローがトリガーされない**
   - ユーザー権限を確認（OWNER/MEMBER/COLLABORATOR である必要があります）
   - リポジトリ設定で Actions が許可されていることを確認
   - シークレットが適切に設定されていることを確認

2. **認証エラー**
   - API キーが有効で期限切れでないことを確認
   - GCP プロジェクトの権限を確認
   - Workload Identity Federation が正しく設定されていることを確認

3. **レート制限**
   - Google Cloud Console で API 使用状況を監視
   - より良いレート制限のために GitHub App の使用を検討
   - 必要に応じてワークフローの頻度を調整

### デバッグモード

リポジトリ変数で `DEBUG=true` を設定してデバッグログを有効化します。これにより以下が提供されます：
- 詳細な実行ログ
- GitHub イベントコンテキスト
- 詳細な AI インタラクションログ

### ヘルプの取得

1. Actions タブでワークフロー実行ログを確認
2. セットアップドキュメントを確認
3. 詳細なトラブルシューティングのためにデバッグモードを有効化
4. 関連するログと設定詳細と共にイシューを開く

## 📈 パフォーマンス

### 一般的な応答時間
- コードレビュー: 2-5分
- イシュートリアージ: 1-3分  
- 一般支援: 1-2分

### リソース使用量
- ワークフローは GitHub ホストランナーで実行されます
- API 呼び出しは Google Cloud クォータに対してカウントされます
- リポジトリパフォーマンスへの影響は最小限です

## 🔄 更新

Gemini CLI 統合は積極的に保守・更新されています。最新機能を取得するには：

1. `GEMINI_CLI_VERSION` を `latest` または特定の新しいバージョンに更新
2. 新機能と破壊的変更についてチェンジログを確認
3. 開発環境で最初に更新をテスト

## 📝 コントリビューション

このリポジトリにコントリビュートする際：
1. AI があなたのプルリクエストを自動的にレビューします
2. マージ前に重要または高重要度の問題に対処してください
3. 複雑な問題については AI アシスタントを活用してください
4. コード品質改善の提案に従ってください

## 📄 ライセンス

この Gemini CLI 統合は、メインリポジトリと同じライセンスに従います。統合は Google の Gemini API と GitHub のインフラストラクチャを使用し、それぞれの利用規約に従います。

---

**始める準備はできましたか？** [セットアップガイド](docs/gemini-cli-setup.md) をチェックして、AI 駆動の開発支援を体験してください！