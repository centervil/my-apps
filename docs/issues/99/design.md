# 設計書: 音声ファイル指定方法の仕様変更

## 1. アーキテクチャ概要

本改修は、`spotify-automation`アプリケーションのCLIインターフェースに焦点を当てます。既存のGoogle Drive連携やフォールバックロジックを削除し、ファイルシステムから直接音声ファイルを取得するシンプルな機構に置き換えます。

主要な変更点は、`argparse`（または同等のCLI引数パーサー）を用いて`--audioPath`という必須引数を導入し、その引数に基づいてアップロード対象ファイルを決定するロジックを実装することです。

## 2. 実装方針

### 2.1. CLI引数の処理

- Pythonの`argparse`ライブラリを使用し、`--audioPath`を`required=True`として定義します。
- これにより、引数が指定されなかった場合に`argparse`が自動的にエラーをハンドルします。

### 2.2. パスの検証とファイル特定ロジック

1.  **パスの存在確認**:
    - `os.path.exists(audio_path)`を使用して、指定されたパスが実在するかを確認します。
    - 存在しない場合は、`FileNotFoundError`を発生させるか、カスタムエラーメッセージを出力して終了します。

2.  **パスの種別判定**:
    - `os.path.isfile(audio_path)`でファイルかどうかを判定します。
      - **ファイルの場合**: そのパスをそのまま処理対象とします。
    - `os.path.isdir(audio_path)`でフォルダかどうかを判定します。
      - **フォルダの場合**:
        1. `os.listdir(audio_path)`でフォルダ内の全エントリを取得します。
        2. 各エントリに対して`os.path.join()`でフルパスを作成し、`os.path.isfile()`でファイルのみをフィルタリングします。
        3. 候補ファイルがない（フォルダが空、またはサブフォルダしかない）場合は、エラーメッセージを出力して終了します。
        4. 候補ファイルがある場合は、`os.path.getmtime()`を使用して各ファイルの最終更新日時を取得し、最も新しいファイルを選択します。

### 2.3. エラーハンドリング

- **パスが存在しない**: 「エラー: 指定されたパス '{path}' は存在しません。」
- **フォルダが空**: 「エラー: 指定されたフォルダ '{path}' には処理対象のファイルが見つかりませんでした。」
- **その他（権限など）**: `try...except`ブロックで予期せぬ`IOError`や`PermissionError`を捕捉し、適切なメッセージを出力します。

### 2.4. 既存コードの削除

- Google Drive API連携に関連するすべてのコード（認証、ファイル検索、ダウンロード処理）を削除します。
- ローカルフォールバックに関連するロジックを削除します。

## 3. テスト戦略

### 3.1. ユニットテスト

`get_audio_file`のような、パスを受け取って対象ファイルのパスを返す関数を想定し、それに対して以下のテストケースを実装します。

- **正常系**:
  - ファイルパスを渡すと、そのファイルパスがそのまま返される。
  - フォルダパスを渡すと、その中の最新更新日時のファイルパスが返される。
- **異常系**:
  - 存在しないパスを渡すと、`FileNotFoundError`が送出される。
  - 空のフォルダパスを渡すと、適切な例外（例: `ValueError`）が送出される。
  - ファイルでもフォルダでもないパス（例: シンボリックリンクなど、意図しないケース）を渡した場合の挙動を定義し、テストする。

### 3.2. E2Eテスト（手動または自動）

- CLIを実際に実行し、以下のシナリオを確認します。
  - ファイルを指定して実行し、成功すること。
  - フォルダを指定して実行し、最新ファイルが処理されて成功すること。
  - 不正なパスを指定し、定義通りのエラーメッセージが出力されること。

## 4. ドキュメント更新

- `README.md`の「使用方法」セクションを更新し、`--audioPath`引数が必須であること、ファイルとフォルダの両方を受け付けることを明記します。具体的なコマンド例も記載します。
