# 設計書 (design.md)

## 1. アーキテクチャ

本機能は、既存のGeminiスラッシュコマンドの拡張として実装されます。`.gemini/commands/` ディレクトリ内の `dev-start.toml` と `dev-end.toml` のプロンプトを更新することで、追加機能を実現します。外部ツールとして `gh` (GitHub CLI) および `jq` を積極的に活用し、シェルスクリプトを介してGitHub APIとの連携やデータ処理を行います。

### 1.1. `/dev-start` コマンド

- **トリガー**: `/dev-start [issue番号]`
- **処理フロー**:
    1.  `git` コマンドで `main` ブランチにいることを確認。
    2.  `gh issue view [issue番号] --json title,body` でissue情報を取得。
    3.  `jq` でJSONをパースし、タイトルと本文を変数に格納。
    4.  タイトルをケバブケースに変換し、`feat/[issue番号]-[ケバブケースのタイトル]` の形式でブランチ名を作成。
    5.  `git checkout -b [ブランチ名]` でブランチを作成・切り替え。
    6.  `mkdir -p docs/issues/[issue番号]` でドキュメント用ディレクトリを作成。
    7.  取得したIssue情報を後続のLLMプロンプトに渡し、`requirements.md`, `design.md`, `tasks.md` を生成させる。

### 1.2. `/dev-end` コマンド

- **トリガー**: `/dev-end`
- **処理フロー**:
    1.  LLMが開発ログを生成し、コミットを作成。
    2.  `git push` で変更をリモートにプッシュ。
    3.  `gh pr create` でプルリクエストを作成。
    4.  `gh pr checks --watch` でCIの完了を待機。
    5.  CIの終了コード (`$?`) を評価。
        - **成功 (0) の場合**: `git checkout main` を実行。
        - **失敗 (非0) の場合**: `gh pr checks [PRのURL]` で失敗したチェックの詳細を表示し、ユーザーに修正を促す。

## 2. テスト戦略

- **ユニットテスト**: 各コマンドのシェルスクリプト部分は、個別の機能（ブランチ名生成、CIステータスチェックなど）ごとにテストします。
- **統合テスト**:
    - `/dev-start` を実際に実行し、ブランチとドキュメントディレクトリが正しく作成されることを確認します。（今回実施中）
    - `/dev-end` を実行し、PRが作成され、CIの監視が正しく開始されることを確認します。
- **手動テスト**: CIの成功/失敗シナリオをシミュレートし、各分岐が期待通りに動作することを確認します。