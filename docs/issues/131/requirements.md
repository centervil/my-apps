# Requirements: クッキーの有効期限を考慮した厳密な認証チェックの実装

## 1. ユーザー定義

- **ユーザー**: `spotify-automation` CLIツールの利用者、またはこのツールを組み込んだCI/CDパイプライン。

## 2. ユーザーストーリー

- **As a** ツール利用者,
- **I want to** 実行時に認証状態が厳密にチェックされ、クッキーが期限切れの場合は即座にエラーが通知されるようにしたい,
- **So that** 期限切れのセッションでブラウザを無駄に起動して時間がかかったり、途中で処理が失敗するのを防ぐことができる。

## 3. 受け入れ基準 (Acceptance Criteria)

### AC1: 厳密なクッキー有効期限チェック
- [ ] `AuthManager.isAuthValid()` メソッドは、認証ファイルの作成日時だけでなく、保存されている各クッキーの `expires` 属性を確認すること。
- [ ] `expires` 属性が存在し、かつ現在時刻よりも過去（期限切れ）であるクッキーが含まれている場合、メソッドは `false` を返すか、`AuthError` をスローすること。
- [ ] セッションクッキー（`expires` が `-1` または設定されていない）は、既存の `maxAgeHours` ロジック（ファイル作成日時からの経過時間）で検証されること。

### AC2: 実行時の事前チェック
- [ ] `runSpotifyUpload` 関数の実行開始直後に、厳密な認証チェックが行われること。
- [ ] 認証が無効と判定された場合、ブラウザ（Firefox）の起動プロセスに進まず、直ちにエラーメッセージを出力して処理を終了すること。

### AC3: エラーハンドリング
- [ ] クッキー期限切れによる認証エラーが発生した場合、ユーザーに「再ログインが必要である」旨の明確なエラーメッセージが表示されること（例: `EXPIRED_AUTH` エラーコードの使用）。
