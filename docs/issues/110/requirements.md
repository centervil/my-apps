# 要件定義書 (requirements.md)

## 1. 概要

本ドキュメントは、Spotifyエピソードアップロードワークフローの改修に関する要件を定義する。現在のワークフローはパラメータがハードコードされており、番組ごとの複製が困難である。この改修により、ワークフローを外部の設定ファイルで駆動されるようにし、再利用性とメンテナンス性を向上させる。

## 2. ユーザーストーリー

### ストーリー1: ワークフロー管理者のための設定の外部化

**As a** ワークフロー管理者、
**I want** Spotifyアップロードワークフローが、エピソード情報（タイトル、説明、音声ファイルパス、ショーIDなど）を外部リポジトリの設ファイルから動的に読み込むようにしたい、
**So that** 番組ごとにワークフローファイルを複製し、設定ファイルの参照先を変えるだけで、新しい番組のアップロードに簡単かつ迅速に対応できる。

### ストーリー2: セキュリティ管理者のための認証情報の一元管理

**As a** セキュリティ管理者、
**I want** ワークフローファイルから不要なSpotify認証情報（クライアントID、シークレット、リフレッシュトークン）を削除したい、
**So that** 認証情報がリポジトリに分散することを防ぎ、CLIツールに集約された認証情報管理の原則を維持できる。

## 3. 受け入れ基準 (Acceptance Criteria)

### AC-1: 不要なSpotify認証情報の削除

-   [ ] `.github/workflows/spotify-upload.yml` ファイルから `SPOTIFY_CLIENT_ID` の環境変数設定が削除されていること。
-   [ ] `.github/workflows/spotify-upload.yml` ファイルから `SPOTIFY_CLIENT_SECRET` の環境変数設定が削除されていること。
-   [ ] `.github/workflows/spotify-upload.yml` ファイルから `SPOTIFY_REFRESH_TOKEN` の環境変数設定が削除されていること。

### AC-2: 外部リポジトリからのパラメータ取得

-   [ ] ワークフローに、外部の公開リポジトリから設定ファイル（例: `config.json`）をチェックアウトするステップが追加されていること。
-   [ ] 外部リポジトリのURLと設定ファイルのパスが、ワークフローのjobレベルの `env` 変数として定義されていること。
-   [ ] チェックアウトした設定ファイルの内容をパースし、以下のパラメータを後続ステップで利用可能な環境変数として設定するステップが追加されていること。
    -   `EPISODE_TITLE` (エピソードのタイトル)
    -   `EPISODE_DESCRIPTION` (エピソードの説明)
    -   `AUDIO_FILE_PATH` (オーディオファイルのパス)
    *   `SHOW_ID` (ショーID)

### AC-3: `upload.sh` スクリプトへのパラメータ渡し

-   [ ] `apps/ui-automations/spotify-automation/scripts/upload.sh` を実行するステップが、AC-2で設定した環境変数（`EPISODE_TITLE`, `EPISODE_DESCRIPTION`, `AUDIO_FILE_PATH`, `SHOW_ID`）を引数としてスクリプトに渡すように修正されていること。

### AC-4: 複製容易性の確保

-   [ ] 番組固有の設定（外部リポジトリURL、設定ファイルパスなど）が、ワークフローファイルの先頭付近にあるjobレベルの `env` ブロックに集約されていること。
-   [ ] 複製時に変更が必要な `env` 変数には、その役割を説明するコメントが付与されていること。