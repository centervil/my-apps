# 要件定義書: `spotify-automation` CLI E2Eテスト

## 1. 概要

`spotify-automation` CLIツールのコア機能が期待通りに動作することを保証するため、エンドツーエンド（E2E）テストスイートを実装する。これにより、手動テストの労力を削減し、将来の変更に対する信頼性の高いセーフティネットを構築する。

## 2. ユーザーストーリー

### ユーザーストーリー1: 正常系の動作検証

- **As a** 開発者
- **I want to** CLIツールの正常系ユースケース（ローカルファイルアップロード、Google Driveからの自動アップロード）を検証するE2Eテストを実行したい
- **So that** コア機能が正しく動作していることを迅速に確認できる。

### ユーザーストーリー2: 異常系の動作検証

- **As a** 開発者
- **I want to** CLIツールの主要なエラーケース（必須オプション欠如、認証失敗、ファイル不在など）を検証するE2Eテストを実行したい
- **So that** 予期せぬエラー発生時にツールが適切に終了し、明確なエラーメッセージを返すことを保証できる。

### ユーザーストーリー3: テストの統合と実行

- **As a** 開発者
- **I want to** E2Eテストを既存の開発ワークフローに統合し、単一のコマンドで実行できるようにしたい
- **So that** テストの実行が容易になり、開発サイクルに自然に組み込まれる。

## 3. 受け入れ基準

### 正常系 (Happy Path)

- `[ ]` ローカルの音声ファイルパスを`--audioPath`オプションで指定し、アップロードが成功することを検証するテストケースが存在すること。
- `[ ]` オプションを指定しない場合に、Google Driveから最新のファイルが自動的に検出され、アップロードが成功することを検証するテストケースが存在すること。

### 異常系 (Error Cases)

- `[ ]` 必須の`--showId`オプションが指定されなかった場合に、プロセスがエラーで終了することを検証するテストケースが存在すること。
- `[ ]` 不正なSpotify認証情報が設定された場合に、ログインに失敗し、プロセスがエラーで終了することを検証するテストケースが存在すること。
- `[ ]` `--audioPath`で指定された音声ファイルが存在しない場合に、プロセスがエラーで終了することを検証するテストケースが存在すること。
- `[ ]` 不正なGoogle Drive認証情報が設定された場合に、認証に失敗し、プロセスがエラーで終了することを検証するテストケースが存在すること。
- `[ ]` Google Driveの対象フォルダにファイルが存在しない場合に、プロセスがエラーで終了することを検証するテストケースが存在すること。

### 統合とドキュメント

- `[ ]` すべてのE2Eテストは`pnpm nx affected:test`コマンドで実行可能であること。
- `[ ]` テストはローカル開発環境で実行可能であること。
- `[ ]` テストのセットアップ方法と実行手順が`README.md`に記載されていること。
- `[ ]` テストは、開発者のローカル環境に設定された実際のSpotifyおよびGoogle Driveの認証情報を使用して実行されること。
